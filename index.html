<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vampire: The Masquerade - San Francisco</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Intro Screen -->
    <div id="introScreen" class="intro-screen">
        <div class="intro-background">
            <div class="intro-moon"></div>
            <div class="intro-fog"></div>
        </div>
        <div class="intro-content">
            <div class="intro-header">
                <h1 class="intro-title">VAMPIRE</h1>
                <h2 class="intro-subtitle">THE MASQUERADE</h2>
                <h3 class="intro-location">San Francisco by Night</h3>
            </div>
            
            <div class="intro-menu">
                <button id="startBtn" class="intro-btn start-btn">
                    <span class="btn-icon">üåô</span>
                    <span class="btn-text">Start Game</span>
                </button>
                
                <button id="loadBtn" class="intro-btn load-btn">
                    <span class="btn-icon">üíæ</span>
                    <span class="btn-text">Load Game</span>
                </button>
                
                <button id="optionsBtn" class="intro-btn options-btn disabled">
                    <span class="btn-icon">‚öôÔ∏è</span>
                    <span class="btn-text">Options</span>
                </button>
                
                <button id="exitBtn" class="intro-btn exit-btn disabled">
                    <span class="btn-icon">üö™</span>
                    <span class="btn-text">Exit Game</span>
                </button>
            </div>
            
            <div class="intro-footer">
                <p class="intro-tagline">"The Beast calls, but you must not answer..."</p>
                <p class="intro-version">Version 1.0 - Demo</p>
            </div>
        </div>
    </div>

    <!-- Character Creation Screen -->
    <div id="characterCreationScreen" class="character-creation-screen hidden">
        <div class="creation-background">
            <div class="creation-moon"></div>
            <div class="creation-fog"></div>
        </div>
        
        <div class="creation-container">
            <div class="creation-header">
                <h1>CHARACTER CREATION</h1>
                <h2>Forge Your Kindred Identity</h2>
            </div>
            
            <div class="creation-content">
                <!-- Character Portrait Section -->
                <div class="creation-section portrait-section">
                    <h3>Character Portrait</h3>
                    <div class="portrait-container">
                        <div class="portrait-frame">
                            <img id="characterPortrait" src="" alt="Character Portrait" class="portrait-image hidden">
                            <div id="portraitPlaceholder" class="portrait-placeholder">
                                <span class="portrait-icon">üë§</span>
                                <p>Click to add portrait</p>
                            </div>
                        </div>
                        <input type="file" id="portraitInput" accept=".png,.jpg,.jpeg" class="portrait-input">
                        <button id="portraitBtn" class="portrait-button">Choose Image</button>
                    </div>
                </div>
                
                <!-- Character Name -->
                <div class="creation-section name-section">
                    <h3>Character Name</h3>
                    <input type="text" id="characterName" class="character-name-input" placeholder="Enter your character's name..." maxlength="30">
                </div>
                
                <!-- Attributes Section -->
                <div class="creation-section attributes-section">
                    <h3>Attributes <span class="points-display" id="attributePoints">(7 points to spend)</span></h3>
                    <div class="attributes-grid">
                        <div class="attribute-block">
                            <label>Physical</label>
                            <div class="dots-container" id="physicalDots">
                                <span class="dot active" data-value="1"></span>
                                <span class="dot" data-value="2"></span>
                                <span class="dot" data-value="3"></span>
                                <span class="dot" data-value="4"></span>
                                <span class="dot" data-value="5"></span>
                            </div>
                            <span class="attribute-value" id="physicalValue">1</span>
                        </div>
                        <div class="attribute-block">
                            <label>Social</label>
                            <div class="dots-container" id="socialDots">
                                <span class="dot active" data-value="1"></span>
                                <span class="dot" data-value="2"></span>
                                <span class="dot" data-value="3"></span>
                                <span class="dot" data-value="4"></span>
                                <span class="dot" data-value="5"></span>
                            </div>
                            <span class="attribute-value" id="socialValue">1</span>
                        </div>
                        <div class="attribute-block">
                            <label>Mental</label>
                            <div class="dots-container" id="mentalDots">
                                <span class="dot active" data-value="1"></span>
                                <span class="dot" data-value="2"></span>
                                <span class="dot" data-value="3"></span>
                                <span class="dot" data-value="4"></span>
                                <span class="dot" data-value="5"></span>
                            </div>
                            <span class="attribute-value" id="mentalValue">1</span>
                        </div>
                    </div>
                </div>
                
                <!-- Clan Selection -->
                <div class="creation-section clan-section">
                    <h3>Choose Your Clan</h3>
                    <select id="clanSelect" class="clan-dropdown">
                        <option value="">-- Select a Clan --</option>
                        <option value="Ventrue">Ventrue - The Blue Bloods</option>
                        <option value="Toreador">Toreador - The Roses</option>
                        <option value="Tremere">Tremere - The Warlocks</option>
                        <option value="Brujah">Brujah - The Rebels</option>
                        <option value="Gangrel">Gangrel - The Outcasts</option>
                    </select>
                    <div class="clan-info" id="clanInfo">
                        <p class="clan-description">Select a clan to see their traits and abilities.</p>
                    </div>
                </div>
                
                <!-- Faction Selection -->
                <div class="creation-section faction-section">
                    <h3>Choose Your Faction</h3>
                    <select id="factionSelect" class="faction-dropdown">
                        <option value="camarilla">Camarilla - The Ivory Tower</option>
                        <option value="anarchs">Anarch Movement - The Revolution</option>
                        <option value="sabbat">Sabbat - The Sword of Caine</option>
                        <option value="independent">Independent - Unaligned</option>
                    </select>
                    <div class="faction-info" id="factionInfo">
                        <p class="faction-description">The Camarilla represents order, tradition, and the Masquerade. Your faction alignment affects your starting position and map pin colors when you control locations.</p>
                    </div>
                </div>
                
                <!-- Starting Stats Preview -->
                <div class="creation-section stats-section">
                    <h3>Starting Statistics</h3>
                    <div class="stats-grid">
                        <div class="stat-preview">
                            <label>Blood Pool</label>
                            <div class="stat-bar-preview">
                                <div class="stat-fill-preview blood-fill-preview" style="width: 50%"></div>
                                <span class="stat-text">5/10</span>
                            </div>
                        </div>
                        <div class="stat-preview">
                            <label>Humanity</label>
                            <div class="stat-bar-preview">
                                <div class="stat-fill-preview humanity-fill-preview" style="width: 70%"></div>
                                <span class="stat-text">7/10</span>
                            </div>
                        </div>
                        <div class="stat-preview">
                            <label>Resources</label>
                            <span class="stat-number-preview" id="resourcesPreview">$25,000</span>
                        </div>
                        <div class="stat-preview">
                            <label>Contacts</label>
                            <span class="stat-number-preview" id="contactsPreview">5</span>
                        </div>
                    </div>
                </div>
                
                <!-- Coterie Panel (Empty) -->
                <div class="creation-section coterie-section">
                    <h3>Coterie</h3>
                    <div class="coterie-panel" id="coteriePanel">
                        <div class="coterie-empty">
                            <p>Your coterie is empty. Recruit allies during gameplay to fill these positions.</p>
                            <div class="coterie-slots">
                                <div class="coterie-slot empty">Empty</div>
                                <div class="coterie-slot empty">Empty</div>
                                <div class="coterie-slot empty">Empty</div>
                                <div class="coterie-slot empty">Empty</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Creation Actions -->
            <div class="creation-actions">
                <button id="backToIntroBtn" class="creation-btn back-btn">
                    <span class="btn-icon">‚¨ÖÔ∏è</span>
                    <span class="btn-text">Back</span>
                </button>
                
                <button id="createCharacterBtn" class="creation-btn create-btn disabled">
                    <span class="btn-icon">‚ú®</span>
                    <span class="btn-text">Create Character</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Main Game Screen (initially hidden) -->
    <div id="gameScreen" class="game-screen hidden">
        <header class="game-header">
        <div class="moon-container">
            <div class="moon" id="moonIcon">üåï</div>
            <div class="moon-glow" id="moonGlow"></div>
        </div>
        <h1>Vampire: The Masquerade</h1>
        <h2>San Francisco by Night</h2>
        <div class="game-status">
            <div class="night-counter">Night: <span id="currentNight">1</span></div>
            <div class="time-phase">Phase: <span id="currentPhase">Dusk</span></div>
            <div class="phase-debug">Index: <span id="phaseDebug">0</span></div>
            <button id="nextTurnBtn" class="turn-button">Next Turn</button>
        </div>
    </header>
    
    <div class="game-container">
        <div class="sidebar">
            <div class="character-portrait-display" id="characterPortraitDisplay" style="display: none;">
                <img id="sidebarCharacterPortrait" src="" alt="Character Portrait" class="sidebar-portrait">
                <div class="character-summary">
                    <h4 id="sidebarCharacterName">Character Name</h4>
                    <p id="sidebarCharacterClan">Clan</p>
                </div>
            </div>
            <div class="player-stats">
                <h3>Character Status</h3>
                <div class="stat-item">
                    <span class="stat-label">Blood Pool:</span>
                    <div class="stat-bar">
                        <div class="stat-fill blood-fill" id="bloodFill"></div>
                        <span class="stat-value" id="bloodValue">10/10</span>
                    </div>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Humanity:</span>
                    <div class="stat-bar">
                        <div class="stat-fill humanity-fill" id="humanityFill"></div>
                        <span class="stat-value" id="humanityValue">7/10</span>
                    </div>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Influence:</span>
                    <div class="stat-bar">
                        <div class="stat-fill influence-fill" id="influenceFill"></div>
                        <span class="stat-value" id="influenceValue">3/10</span>
                    </div>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Contacts:</span>
                    <span class="stat-number" id="contactsValue">5</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Resources:</span>
                    <span class="stat-number" id="resourcesValue">$25,000</span>
                </div>
            </div>
            
            <div class="character-sheet" id="characterSheet">
                <h3>Character Sheet</h3>
                <div class="character-info" id="characterInfo" style="display: none;">
                    <div class="character-portrait">
                        <img id="characterClanSymbol" src="" alt="Clan Symbol" class="clan-symbol">
                    </div>
                    <div class="character-details">
                        <div class="character-basic">
                            <h4 id="characterName">Character Name</h4>
                            <p class="character-clan" id="characterClan">Clan</p>
                            <p class="character-faction" id="characterFaction">Faction</p>
                        </div>
                        <div class="character-attributes">
                            <div class="attribute-row">
                                <span class="attribute-label">Physical:</span>
                                <span id="characterPhysical">1</span>
                            </div>
                            <div class="attribute-row">
                                <span class="attribute-label">Social:</span>
                                <span id="characterSocial">1</span>
                            </div>
                            <div class="attribute-row">
                                <span class="attribute-label">Mental:</span>
                                <span id="characterMental">1</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="no-character" id="noCharacter">
                    <p>No character created yet.</p>
                    <button id="createCharacterSheetBtn" class="action-btn">Create Character</button>
                </div>
            </div>
            
            <div class="coterie-panel" id="coteriePanel">
                <h3>Coterie</h3>
                <div class="coterie-members" id="coterieMembers">
                    <p class="empty-coterie">No coterie members yet.</p>
                </div>
                <div class="coterie-actions">
                    <button id="recruitBtn" class="action-btn" disabled>Recruit Ally</button>
                    <button id="coterieManagementBtn" class="action-btn" disabled>Manage Coterie</button>
                </div>
            </div>
            
            <div class="save-load-section">
                <h3>Game Management</h3>
                <button class="save-btn" id="saveGameBtn">Save Game</button>
                <button class="load-btn" id="loadGameBtn">Load Game</button>
                <button class="reset-btn" id="resetGameBtn">New Game</button>
            </div>
            
            <div class="game-actions">
                <h3>Actions</h3>
                <button class="action-btn" id="influenceBtn">Influence</button>
                <button class="action-btn" id="feedBtn">Feed</button>
                <button class="action-btn" id="gatherBtn">Gather Intel</button>
                <button class="action-btn" id="meetBtn">Meet Contact</button>
                <button class="action-btn debug-btn" id="debugPhaseBtn" style="background: #666; margin-top: 10px;">DEBUG: Test Phase</button>
            </div>
        </div>
        
        <div id="map"></div>
    </div>
    
    <!-- Telegram-style popup window -->
    <div id="telegramPopup" class="telegram-popup hidden">
        <div class="telegram-window">
            <div class="telegram-header">
                <div class="telegram-title">
                    <span class="telegram-icon">üìß</span>
                    <span id="telegramSender">Unknown Contact</span>
                </div>
                <button class="telegram-close" onclick="closeTelegram()">√ó</button>
            </div>
            <div class="telegram-content">
                <div class="telegram-message" id="telegramMessage">
                    Welcome to the San Francisco Vampire political network.
                </div>
                <div class="telegram-actions" id="telegramActions">
                    <button class="telegram-action-btn" onclick="handleTelegramAction('accept')">Accept</button>
                    <button class="telegram-action-btn" onclick="handleTelegramAction('decline')">Decline</button>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="characters.js"></script>
    <script src="faction-intros.js"></script>
    <script src="game-init.js"></script>
    <script src="main.js"></script>
</body>
</html>